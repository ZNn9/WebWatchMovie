<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<!-- CSS -->
	<link th:href="@{/admin-css/bootstrap.min.css}" rel="stylesheet">
	<link th:href="@{/admin-css/slimselect.css}" rel="stylesheet">
	<link th:href="@{/admin-css/admin.css}" rel="stylesheet">

	<!-- Favicons -->
	<link th:href="@{/icon/favicon-32x32.png}" rel="icon" type="image/png" sizes="32x32">
	<link th:href="@{/icon/favicon-32x32.png}" rel="apple-touch-icon">

	<meta name="description" content="">
	<meta name="keywords" content="">
	<meta name="author" content="Dmitry Volkov">
	<title>Movie Catalog</title>

	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<style>
		.text-red {
			color: red;
		}
	    .text-white{
            color: white;
        }
	</style>
</head>
<body>
<!-- header -->
<header class="header">
	<div class="header__content">
		<!-- header logo -->
		<a th:href="@{/}" class="header__logo">
			<img th:src="@{/img/logo.png}" alt="">
		</a>
		<!-- end header logo -->

		<!-- header menu btn -->
		<button class="header__btn" type="button">
			<span></span>
			<span></span>
			<span></span>
		</button>
		<!-- end header menu btn -->
	</div>
</header>
<!-- end header -->

<!-- sidebar -->
<div class="sidebar">
	<!-- sidebar logo -->
	<a th:href="@{/admin/index}" class="sidebar__logo">
		<img th:src="@{/img/logo.png}" alt="">
	</a>
	<!-- end sidebar logo -->

	<!-- sidebar user -->
	<div class="sidebar__user">
		<div class="sidebar__user-img">
			<img th:src="@{/img/user.png}" alt="">
		</div>

		<div class="sidebar__user-title">
			<span>Admin</span>
			<p>Bao</p>
		</div>

		<button class="sidebar__user-btn" type="button">
			<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
				<path d="M4,12a1,1,0,0,0,1,1h7.59l-2.3,2.29a1,1,0,0,0,0,1.42,1,1,0,0,0,1.42,0l4-4a1,1,0,0,0,.21-.33,1,1,0,0,0,0-.76,1,1,0,0,0-.21-.33l-4-4a1,1,0,1,0-1.42,1.42L12.59,11H5A1,1,0,0,0,4,12ZM17,2H7A3,3,0,0,0,4,5V8A1,1,0,0,0,6,8V5A1,1,0,0,1,7,4H17a1,1,0,0,1,1,1V19a1,1,0,0,1-1,1H7a1,1,0,0,1-1-1V16a1,1,0,0,0-2,0v3a3,3,0,0,0,3,3H17a3,3,0,0,0,3-3V5A3,3,0,0,0,17,2Z"></path>
			</svg>
		</button>
	</div>
	<!-- end sidebar user -->

	<!-- sidebar nav -->
	<ul class="sidebar__nav">
		<li class="sidebar__nav-item">
			<a th:href="@{/admin/index}" class="sidebar__nav-link sidebar__nav-link--active">
				<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
					<path d="M10,13H3a1,1,0,0,0-1,1v7a1,1,0,0,0,1,1h7a1,1,0,0,0,1-1V14A1,1,0,0,0,10,13ZM9,20H4V15H9ZM21,2H14a1,1,0,0,0-1,1v7a1,1,0,0,0,1,1h7a1,1,0,0,0,1-1V3A1,1,0,0,0,21,2ZM20,9H15V4h5Zm1,4H14a1,1,0,0,0-1,1v7a1,1,0,0,0,1,1h7a1,1,0,0,0,1-1V14A1,1,0,0,0,21,13Zm-1,7H15V15h5ZM10,2H3A1,1,0,0,0,2,3v7a1,1,0,0,0,1,1h7a1,1,0,0,0,1-1V3A1,1,0,0,0,10,2ZM9,9H4V4H9Z"></path>
				</svg>
				Dashboard
			</a>
		</li>

		<li class="sidebar__nav-item">
			<a th:href="@{/admin/catalog}" class="sidebar__nav-link">
				<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
					<path d="M21,2a1,1,0,0,0-1,1V5H18V3a1,1,0,0,0-2,0V4H8V3A1,1,0,0,0,6,3V5H4V3A1,1,0,0,0,2,3V21a1,1,0,0,0,2,0V19H6v2a1,1,0,0,0,2,0V20h8v1a1,1,0,0,0,2,0V19h2v2a1,1,0,0,0,2,0V3A1,1,0,0,0,21,2ZM6,17H4V15H6Zm0-4H4V11H6ZM6,9H4V7H6Zm10,9H8V13h8Zm0-7H8V6h8Zm4,6H18V15h2Zm0-4H18V11h2Zm0-4H18V7h2Z"></path>
				</svg>
				Catalog
			</a>
		</li>

		<li class="sidebar__nav-item">
			<a th:href="@{/admin/users}" class="sidebar__nav-link">
				<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
					<path d="M12,2A10,10,0,0,0,4.65,18.76h0a10,10,0,0,0,14.7,0h0A10,10,0,0,0,12,2Zm0,18a8,8,0,0,1-5.55-2.25,6,6,0,0,1,11.1,0A8,8,0,0,1,12,20ZM10,10a2,2,0,1,1,2,2A2,2,0,0,1,10,10Zm8.91,6A8,8,0,0,0,15,12.62a4,4,0,1,0-6,0A8,8,0,0,0,5.09,16,7.92,7.92,0,0,1,4,12a8,8,0,0,1,16,0A7.92,7.92,0,0,1,18.91,16Z"></path>
				</svg>
				Users
			</a>
		</li>

		<li class="sidebar__nav-item">
			<a th:href="@{/admin/comments}" class="sidebar__nav-link">
				<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
					<path d="M20.61,19.19A7,7,0,0,0,17.87,8.62,8,8,0,1,0,3.68,14.91L2.29,16.29a1,1,0,0,0-.21,1.09A1,1,0,0,0,3,18H8.69A7,7,0,0,0,15,22h6a1,1,0,0,0,.92-.62,1,1,0,0,0-.21-1.09ZM8,15a6.63,6.63,0,0,0,.08,1H5.41l.35-.34a1,1,0,0,0,0-1.42A5.93,5.93,0,0,1,4,10a6,6,0,0,1,6-6,5.94,5.94,0,0,1,5.65,4c-.22,0-.43,0-.65,0A7,7,0,0,0,8,15ZM18.54,20l.05.05H15a5,5,0,1,1,3.54-1.46,1,1,0,0,0-.3.7A1,1,0,0,0,18.54,20Z"></path>
				</svg>
				Comments
			</a>
		</li>

		<li class="sidebar__nav-item">
			<a th:href="@{/admin/reviews}" class="sidebar__nav-link">
				<svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" viewBox="0 0 24 24">
					<path d="M22,10.1c0.1-0.5-0.3-1.1-0.8-1.1l-5.7-0.8L12.9,3c-0.1-0.2-0.2-0.3-0.4-0.4C12,2.3,11.4,2.5,11.1,3L8.6,8.2L2.9,9C2.6,9,2.4,9.1,2.3,9.3c-0.4,0.4-0.4,1,0,1.4l4.1,4l-1,5.7c0,0.2,0,0.4,0.1,0.6c0.3,0.5,0.9,0.7,
						1.4,0.4l5.1-2.7l5.1,2.7c0.1,0.1,0.3,0.1,0.5,0.1v0c0.1,0,0.1,0,0.2,0c0.5-0.1,0.9-0.6,0.8-1.2l-1-5.7l4.1-4C21.9,10.5,22,10.3,22,10.1z M15.8,13.6c-0.2,0.2-0.3,0.6-0.3,0.9l0.7,4.2l-3.8-2c-0.1-0.1-0.3-0.1-0.5-0.1V5.7l1.9,3.8c0.1,0.3,0.4,0.5,0.8,0.5l4.2,0.6L15.8,13.6z"></path>
				</svg>
				Reviews
			</a>
		</li>

		<li class="sidebar__nav-item">
			<a th:href="@{/originmovies}" class="sidebar__nav-link">
				<svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" viewBox="0 0 24 24">
					<path d="M22,10.1c0.1-0.5-0.3-1.1-0.8-1.1l-5.7-0.8L12.9,3c-0.1-0.2-0.2-0.3-0.4-0.4C12,2.3,11.4,2.5,11.1,3L8.6,8.2L2.9,9C2.6,9,2.4,9.1,2.3,9.3c-0.4,0.4-0.4,1,0,1.4l4.1,4l-1,5.7c0,0.2,0,0.4,0.1,0.6c0.3,0.5,0.9,0.7,1.4,0.4l5.1-2.7l5.1,2.7c0.1,0.1,0.3,0.1,0.5,0.1v0c0.1,0,0.1,0,0.2,0c0.5-0.1,0.9-0.6,0.8-1.2l-1-5.7l4.1-4C21.9,10.5,22,10.3,22,10.1z M15.8,13.6c-0.2,0.2-0.3,0.6-0.3,0.9l0.7,4.2l-3.8-2c-0.1-0.1-0.3-0.1-0.5-0.1V5.7l1.9,3.8c0.1,0.3,0.4,0.5,0.8,0.5l4.2,0.6L15.8,13.6z"></path>
				</svg>
				OriginMovie
			</a>
		</li>

		<li class="sidebar__nav-item">
			<a th:href="@{/admin/tag}" class="sidebar__nav-link">
				<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
					<path d="M21,2a1,1,0,0,0-1,1V5H18V3a1,1,0,0,0-2,0V4H8V3A1,1,0,0,0,6,3V5H4V3A1,1,0,0,0,2,3V21a1,1,0,0,0,2,0V19H6v2a1,1,0,0,0,2,0V20h8v1a1,1,0,0,0,2,0V19h2v2a1,1,0,0,0,2,0V3A1,1,0,0,0,21,2ZM6,17H4V15H6Zm0-4H4V11H6ZM6,9H4V7H6Zm10,9H8V13h8Zm0-7H8V6h8Zm4,6H18V15h2Zm0-4H18V11h2Zm0-4H18V7h2Z"></path>
				</svg>
				Tag
			</a>
		</li>

		<!-- dropdown -->
		<li class="sidebar__nav-item">
			<a class="sidebar__nav-link" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
				<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
					<path d="M21,8.94a1.31,1.31,0,0,0-.06-.27l0-.09a1.07,1.07,0,0,0-.19-.28h0l-6-6h0a1.07,1.07,0,0,0-.28-.19.32.32,0,0,0-.09,0A.88.88,0,0,0,14.05,2H10A3,3,0,0,0,7,5V6H6A3,3,0,0,0,3,9V19a3,3,0,0,0,3,3h8a3,3,0,0,0,3-3V18h1a3,3,0,0,0,3-3V9S21,9,21,8.94ZM15,5.41,17.59,8H16a1,1,0,0,1-1-1ZM15,19a1,1,0,0,1-1,1H6a1,1,0,0,1-1-1V9A1,1,0,0,1,6,8H7v7a3,3,0,0,0,3,3h5Zm4-4a1,1,0,0,1-1,1H10a1,1,0,0,1-1-1V5a1,1,0,0,1,1-1h3V7a3,3,0,0,0,3,3h3Z"></path>
				</svg>
				Pages
			</a>

			<ul class="dropdown-menu sidebar__dropdown-menu scrollbar-dropdown">
				<li><a th:href="@{/admin/add-item}">Add item</a></li>
				<li><a th:href="@{/admin/edit-user}">Edit user</a></li>
				<li><a th:href="@{/user/login}">Login In</a></li>
				<li><a th:href="@{/user/signup}">Sign Up</a></li>
				<li><a th:href="@{/admin/forgot}">Forgot password</a></li>
			</ul>
		</li>
		<!-- end dropdown -->
	</ul>
	<!-- end sidebar nav -->

	<!-- sidebar copyright -->
	<div class="sidebar__copyright">© FlixGo, 2018—2023. <br>Create by <a
			href="https://themeforest.net/user/dmitryvolkov/portfolio" target="_blank" rel="noopener">Dmitry
		Volkov</a>.</div>
	<!-- end sidebar copyright -->
</div>
<!-- end sidebar -->

<!-- main content -->
<main class="main">
	<div class="container-fluid">
		<div class="row">
			<!-- main title -->
			<div class="col-12">
				<div class="main__title">
					<h2>Catalog</h2>

					<div class="main__title-wrap">
						<button class="main__title-link" data-bs-toggle="modal" data-bs-target="#modal-movie"><span>add item</span></button>

						<!-- search -->
						<form action="#" class="main__title-form">
							<input type="text" id="searchInput" placeholder="Find movie...">
							<button type="button" id="searchButton">
								<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
									<path d="M21.71,20.29,18,16.61A9,9,0,1,0,16.61,18l3.68,3.68a1,1,0,0,0,1.42,0A1,1,0,0,0,21.71,20.29ZM11,18a7,7,0,1,1,7-7A7,7,0,0,1,11,18Z"></path>
								</svg>
							</button>
						</form>
						<!-- end search -->
					</div>
				</div>
			</div>
			<!-- end main title -->

			<!-- items -->
			<div class="col-12">
				<div class="catalog catalog--1">
					<table class="catalog__table">
						<thead>
						<tr>
							<th class="text-white">ID</th>
							<th class="text-white" >NAME</th>
							<th class="text-white" >DESCRIPTION</th>
							<th class="text-white" >VIEWS</th>
							<th class="text-white" >RATING</th>
							<th class="text-white" >STATUS</th>
							<th class="text-white" >ACTIONS</th>
						</tr>
						</thead>
						<tbody id="moviesTableBody">
						<!-- Movies will be dynamically added here -->
						</tbody>
					</table>
				</div>
			</div>
			<!-- end items -->
		</div>
	</div>
</main>
<!-- end main content -->

<!-- Add/Edit Movie Modal -->
<div class="modal fade" id="modal-movie" tabindex="-1" aria-labelledby="modal-movie" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<div class="modal__content">
				<form id="movieForm" class="modal__form">
					<h4 class="modal__title">Add/Edit Movie</h4>

					<input type="hidden" id="movieId">

					<div class="mb-3">
						<label for="movieName" class="form-label">Name</label>
						<input type="text" class="form-control" id="movieName" required>
					</div>

					<div class="mb-3">
						<label for="movieDescription" class="form-label">Description</label>
						<textarea class="form-control" id="movieDescription" required></textarea>
					</div>

					<div class="mb-3">
						<label for="movieViews" class="form-label">Total Quantity View</label>
						<input type="number" class="form-control" id="movieViews" required>
					</div>

					<div class="mb-3">
						<label for="movieRating" class="form-label">Quality Rating</label>
						<input type="number" class="form-control" id="movieRating" step="0.1" required>
					</div>

					<div class="mb-3">
						<label for="movieStatus" class="form-label">Status</label>
						<select class="form-control" id="movieStatus" required>
							<!-- Options will be dynamically loaded here -->
						</select>
					</div>

					<div class="modal__btns">
						<button class="modal__btn modal__btn--apply" type="submit"><span>Save</span></button>
						<button class="modal__btn modal__btn--dismiss" type="button" data-bs-dismiss="modal" aria-label="Close"><span>Cancel</span></button>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>
<!-- end Add/Edit Movie Modal -->

<!-- JS -->
<script th:src="@{/admin-js/bootstrap.bundle.min.js}"></script>
<script th:src="@{/admin-js/smooth-scrollbar.js}"></script>
<script th:src="@{/admin-js/slimselect.min.js}"></script>
<script th:src="@{/admin-js/admin.js}"></script>

<script>
	$(document).ready(function () {
    loadMovies();
    loadStatuses();

    $('#movieForm').submit(function (event) {
        event.preventDefault();
        saveMovie();
    });

    $('#searchButton').click(function () {
        loadMovies($('#searchInput').val());
    });

    function loadMovies(query = '') {
        $.ajax({
            url: '/api/movies',
            method: 'GET',
            dataType: 'json',
            success: function (data) {
                $('#moviesTableBody').empty();
                data.forEach(movie => {
                    $('#moviesTableBody').append(`
                        <tr>
                            <td class="text-red">${movie.idMovie}</td>
                            <td class="text-red">${movie.name}</td>
                            <td class="text-red">${movie.description}</td>
                            <td class="text-red">${movie.totalQuantityView}</td>
                            <td class="text-red">${movie.qualityRating}</td>
                            <td class="text-red">${movie.status.name}</td>
                            <td>
                                <button type="button" class="btn btn-primary" onclick="editMovie(${movie.idMovie})">Edit</button>
                                <button type="button" class="btn btn-danger" onclick="deleteMovie(${movie.idMovie})">Delete</button>
                            </td>
                        </tr>
                    `);
                });
            },
            error: function (error) {
                console.error("Error loading movies:", error);
            }
        });
    }

    function loadStatuses() {
        $.ajax({
            url: '/api/statuses',
            method: 'GET',
            dataType: 'json',
            success: function (data) {
                $('#movieStatus').empty();
                data.forEach(status => {
                    $('#movieStatus').append(`
                        <option value="${status.idStatus}">${status.name}</option>
                    `);
                });
            },
            error: function (error) {
                console.error("Error loading statuses:", error);
            }
        });
    }

    function saveMovie() {
        const movie = {
            idMovie: $('#movieId').val(),
            name: $('#movieName').val(),
            description: $('#movieDescription').val(),
            totalQuantityView: $('#movieViews').val(),
            qualityRating: $('#movieRating').val(),
            status: { idStatus: $('#movieStatus').val() }
        };

        const method = movie.idMovie ? 'PUT' : 'POST';
        const url = movie.idMovie ? `/api/movies/${movie.idMovie}` : '/api/movies';

        console.log("Saving movie:", movie);

        $.ajax({
            url: url,
            method: method,
            contentType: 'application/json',
            data: JSON.stringify(movie),
            success: function () {
                console.log("Movie saved successfully");
                $('#modal-movie').modal('hide');
                loadMovies();
            },
            error: function (error) {
                console.error("Error saving movie:", error);
            }
        });
    }

    window.editMovie = function (id) {
        console.log("Editing movie with ID:", id);
        $.ajax({
            url: `/api/movies/${id}`,
            method: 'GET',
            dataType: 'json',
            success: function (data) {
                console.log("Movie data fetched:", data);
                $('#movieId').val(data.idMovie);
                $('#movieName').val(data.name);
                $('#movieDescription').val(data.description);
                $('#movieViews').val(data.totalQuantityView);
                $('#movieRating').val(data.qualityRating);
                $('#movieStatus').val(data.status.idStatus);
                $('#modal-movie').modal('show');
            },
            error: function (error) {
                console.error("Error fetching movie details:", error);
            }
        });
    };

    window.deleteMovie = function (id) {
        console.log("Deleting movie with ID:", id);
        $.ajax({
            url: `/api/movies/${id}`,
            method: 'DELETE',
            success: function () {
                console.log("Movie deleted successfully");
                loadMovies();
            },
            error: function (error) {
                console.error("Error deleting movie:", error);
            }
        });
    };
});
</script>

</body>
</html>
